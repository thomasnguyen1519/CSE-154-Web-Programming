!function(){"use strict";function e(){$("title").innerText="Game Menu",hide([$("game-view"),$("main-menu-btn")]),hide(this),show($("menu-view"));for(var e=$$(".health-bar.low-health"),t=0;t<e.length;t++)e[t].classList.remove("low-health")}function t(){n(),$("new-game-btn").onclick=function(){O(this.id,"new-game-view")},$("choose-pokemon-btn").onclick=function(){r("pokedex-view",pid),toggleDisplay($$("#new-game-view .part-iii")),this.classList.toggle("chosen-btn")},$("start-game").onclick=function(){""!=G&&(""==J&&(J="-bot-"),_(J))},r("pokedex-view",pid)}function n(){for(var e=$$(".opponent-btn"),t=0;t<e.length;t++)e[t].onclick=function(){hide([$$("#new-game-view .part-ii"),$$("#new-game-view .part-iii")]),this.classList.toggle("chosen-btn");for(var t=$$("#new-game-view button"),n=0;n<t.length;n++)t[n]!=this&&t[n].classList.remove("chosen-btn");for(var n=0;n<e.length;n++)if(e[n]!=this)if(this.classList.contains("chosen-btn"))e[n].classList.remove("chosen-btn"),"student"!=this.id&&hide($("choose-student")),show($$("#new-game-view .part-ii"));else{hide([$$("#new-game-view .part-ii")]),hide([$$("#new-game-view .part-iii")]);for(var t=$$("#new-game-view button"),o=0;o<t.length;o++)t[o].classList.remove("chosen-btn");show(e[n])}"student"==this.id?(toggleDisplay($("choose-student")),$("choose-student").classList.contains("hidden")||(J="whitab")):J=this.id}}function o(){$("trade-btn").onclick=function(){O(this.id,"trade-view"),hide($("current-proposals-view")),hide($("new-proposal-view"))},$("propose").onclick=function(){this.classList.toggle("chosen-btn"),this.classList.contains("chosen-btn")&&$("view-proposals").classList.remove("chosen-btn"),hide($("current-proposals-view")),toggleDisplay($("new-proposal-view")),$("new-proposal-view").classList.contains("hidden")&&(show($("show-p2-dex")),hide($("pokedices")))},$("propose-submit").onclick=v,$("view-proposals").onclick=function(){toggleDisplay($("current-proposals-view")),this.classList.toggle("chosen-btn"),hide($("new-proposal-view")),this.classList.contains("chosen-btn")&&($("propose").classList.remove("chosen-btn"),a())},$("show-p2-dex").onclick=function(){show([$$("#new-proposal-view .part-iv"),$("pokedices")]),this.classList.add("hidden"),r("my-pokemon",pid),r("their-pokemon",$("users").value)},$("users").onchange=function(){r("my-pokemon",pid),r("their-pokemon",$("users").value)}}function s(){$("invite-btn").onclick=function(){i()}}function i(){getRequest(WEBSTER_PHP+"list-games.php",creds(),y)}function r(e,t){getRequest(WEBSTER_PHP+"users.php","?mode=pokemon&pid="+t,function(){g(e,JSON.parse(this.responseText))})}function a(){var e=WEBSTER_PHP+"list-trades.php";getRequest(e,creds(),c)}function p(e,t){getRequest(WEBSTER_PHP+"trade-info.php",creds()+"&trade_id="+e,function(){var e=JSON.parse(this.responseText);h(e,t)})}function d(){getRequest(WEBSTER_PHP+"list-users.php","",u)}function c(){var e=JSON.parse(this.responseText);console.log(e),0==e.offers_to_me.length&&0==e.offers_from_me.length?($("trade-message").innerHTML="There are no trades currently offered to you.",show($("trade-message"))):l(e)}function l(e){var t="<tr><th>Player</th><th>Offer</th><th>Request</th><th>Date</th></tr>",n=e.offers_to_me;n.length>0?$$("#to-you .results-table").innerHTML=t:$$("#to-you .results-table").innerHTML="<p>You do not have any proposals to accept or decline.</p>";for(var o=0;o<n.length;o++){var s=n[o];p(s,"to-you")}var i=e.offers_from_me;i.length>0?$$("#by-you .results-table").innerHTML=t:$$("#by-you .results-table").innerHTML="<p>You do not have any proposals waiting to be accepted or declined by other players.</p>";for(var o=0;o<i.length;o++){var s=i[o];p(s,"by-you")}hide($("trade-message")),show([$("by-you"),$("to-you"),$$("#by-you .results-table"),$$("#to-you .results-table")])}function u(){for(var e=JSON.parse(this.responseText),t=$("users"),n=0;n<e.length;n++)if(e[n]!=pid){var o=document.createElement("option");o.value=e[n],o.innerText=e[n],t.appendChild(o);var s=document.createElement("option");s.value=e[n],s.innerText=e[n],$("opps").appendChild(s)}$("opps").value="whitab",$("users").value="whitab",$("opps").onchange=function(){J=this.value,show($("choose-pokemon-btn")),show($("start-game"))}}function h(e,t){var n=gen("tr");n.id=e.id;var o=genText("td",e.offeree),s=gen("td"),i=genText("p",e.requested_pokemon),r=genText("p",e.offered_pokemon),a=$$("#pokedex-view .sprite[pokemon='"+e.requested_pokemon+"']").cloneNode();s.appendChild(i),i.appendChild(a);var p=gen("td"),d=$$("#pokedex-view .sprite[pokemon='"+e.offered_pokemon+"']").cloneNode();d.classList.remove("unfound"),p.appendChild(r),r.appendChild(d);var c=genText("td",e.created),l=gen("td");if(appendChildren(n,[o,p,s,c]),"to-you"==t){n.setAttribute("togive",i),n.setAttribute("toget",r);var u=genClass("button","small-btn");u.innerText="Accept",u.onclick=f;var h=genClass("button","small-btn");h.innerText="Reject",appendChildren(l,[u,h])}else{var v=genClass("button","small-btn");v.innerText="Cancel Request",l.appendChild(v),v.onclick=m}n.appendChild(l),$$("#"+t+" .results-table tbody").appendChild(n)}function m(){if(confirm("Are you sure you want to cancel this trade?")){var e=this.parentNode.parentNode.id,t=new FormData;t.append("pid",pid),t.append("token",token),t.append("pokemon",this.parentNode.parentNode.querySelectorAll("td")[2].innerText.trim()),t.append("tradeid",e),postRequest(WEBSTER_PHP+"cancel-trade.php",t,function(){alert("Trade successfully canceled"),a()})}}function f(){if(confirm("Are you sure you want to accept this trade?")){var e=this.parentNode.parentNode.id;this.parentNode.parentNode.getAttribute("togive"),this.parentNode.parentNode.getAttribute("toget");trade(togive,toget);var t=new FormData;t.append("pid",pid),t.append("token",token),t.append("action","accept"),t.append("trade_id",e),postRequest(WEBSTER_PHP+"conclude-trade.php",t,function(){alert("Trade successfully accepted"),a()})}}function v(){var e=$("offer").innerText,t=$("request").innerText;if(""!=e&&""!=t){var n=new FormData;n.append("pid",pid),n.append("pid2",$("users").value),n.append("token",token),n.append("pokemon",e),n.append("pokemon2",t),postRequest(WEBSTER_PHP+"offer-trade.php",n,function(){alert("Proposal successful!")})}else alert("Please select a Pokemon to offer and request from the displayed Pokedex views.")}function g(e,t){var n=$(e);w(e);for(var o=0;o<t.length;o++){var s=n.querySelector("img[pokemon='"+t[o]+"']");s.classList.remove("unfound"),"pokedex-view"==e?(G=s.getAttribute("pokemon"),s.onclick=q):s.onclick=b}}function w(e){for(var t=$(e).querySelectorAll(".sprite"),n=0;n<t.length;n++)t[n].classList.add("unfound"),t[n].onclick=""}function b(){this.parentNode.parentNode.querySelector("h2 span")?this.parentNode.parentNode.querySelector("h2 span").innerText=this.getAttribute("pokemon"):(G=this.getAttribute("pokemon"),populateCard("choose-pokemon-card"),show($("start-game")))}function k(){getRequest(WEBSTER_PHP+"pokedex.php","?pokedex=all",T)}function y(){var e=JSON.parse(this.responseText);if(console.log(e),e.offered_by_me||e.offered_to_me||e.in_progress){var t="<tr><th>Other Player</th></tr>";$("games-table").innerHTML=t,e.offered_by_me&&L("Pending","cancel",e.offered_by_me),e.offered_to_me&&L("Pending","accept",e.offered_to_me),e.in_progress&&L("current","join",e.in_progress)}else $$("#invite-results h3").innerHTML="You currently have no games in progress or pending.";O("invite-btn","invite-view")}function T(){for(var e=this.response.split("\n"),t=0;t<e.length-1;t++){var n=e[t].split(":"),o=n[0],s=n[1],i=genClass("img",["sprite","unfound"]);i.src=IMG_BASE+"sprites/"+s,i.setAttribute("pokemon",o),$("my-pokemon").appendChild(i),$("their-pokemon").appendChild(i.cloneNode()),$("pokedex-view").appendChild(i.cloneNode())}}function L(e,t,n){for(var o=0;o<n.length;o++){var s=n[o][0],i=n[o][1];i==pid&&(i=n[o][2]),i||(i="(random)");var r=genText("td",i),a=gen("td"),p=genClass("button",["small-btn"]);if("accept"==t)p.innerText="Accept Invite",p.onclick=function(){P(this.parentNode.parentNode.id,this.parentNode.parentNode.getAttribute("opponent"))},a.appendChild(p);else if("join"==t)p.innerText="Continue Game",a.appendChild(p),p.onclick=function(){S(this.parentNode.parentNode.id)};else if("cancel"==t){var d=genText("span","Invite Pending");a.appendChild(d)}var c=gen("tr");c.id=s;var l=i;"(random)"==i&&(l="-random-"),c.setAttribute("opponent",l),appendChildren(c,[r,a]),$("games-table").appendChild(c)}show($("games-table"))}function P(e,t){var n=new FormData;n.append("pid",pid),n.append("token",token),n.append("guid",e),n.append("opponent",t),n.append("mypokemon",G),postRequest(WEBSTER_PHP+"create-game.php",n,function(){alert("Game invite successfully accepted!")})}function x(){var e=JSON.parse(this.responseText);e.warning?alert(e.warning):(H(e),I=e.guid,console.log(this.responseText),$("title").innerText="Pokemon Battle Mode!",D(),W(),hide([$("menu-view"),$("start-game")]),show([$("game-view"),$("main-menu-btn"),$("results-container")]))}function _(e){if(""==G)alert("Please select a Pokemon to start a game with.");else{var t=new FormData;t.append("opponent",e),t.append("mypokemon",G),t.append("pid",pid),t.append("token",token),postRequest(WEBSTER_PHP+"create-game.php",t,function(){"-bot-"==e?(alert("Game invite sent successfully!"),i()):(alert("Game invite sent successfully!"),i())})}}function S(e){I=e,getRequest(WEBSTER_PHP+"game-info.php",creds()+"&guid="+e,x)}function E(e,t){console.log(t),e="#"+e,$$(e+" .name").innerHTML=t.name,$$(e+" .pokepic").src=IMG_BASE+t.images.photo,$$(e+" .weakness").src=IMG_BASE+t.images.weaknessIcon,$$(e+" .type").src=IMG_BASE+t.images.typeIcon,$$(e+" .info").innerHTML=t.info.description,$$(e+" .hp").innerHTML=t.hp+"HP";for(var n=t.moves,o=$$(e+" .moves button"),s=0;s<n.length;s++){var i=(n[s].name,o[s]);i.classList.contains("hidden")&&i.classList.remove("hidden");var r=i.children[0];r.innerText=n[s].name;var a=i.children[2];a.src=IMG_BASE+"icons/"+n[s].type+".jpg";var p=i.children[1];n[s].dp?p.innerText=n[s].dp+" DP":p.innerText="","#my-card"==e&&(i.disabled=!1,i.onclick=function(){N(this.children[0].innerText)})}for(;4>s;)o[s].classList.add("hidden"),s++}function N(e){$("p1-turn-results").innerHTML="",$("p2-turn-results").innerHTML="",show($("loading")),e=e.toLowerCase();var t=new FormData;t.append("move",e),t.append("guid",I),t.append("pid",pid),t.append("token",token);var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(200===n.status?R(JSON.parse(this.responseText)):alert(JSON.parse(n.statusText).error))},n.open("POST",WEBSTER_PHP+"move.php"),n.send(t)}function q(){$("start-game").classList.contains("hidden")&&$("start-game").classList.remove("hidden");var e=this.getAttribute("pokemon");""!=e&&(G=e,getRequest(WEBSTER_PHP+"pokedex.php","?pokemon="+e,function(){E("chosen-card",JSON.parse(this.responseText)),E("my-card",JSON.parse(this.responseText))}))}function H(e){var t=e.pid1==pid?e.p1:e.p2,n=e.pid1==pid?e.p2:e.p1;E("my-card",t),E("their-card",n),C("my-card",t),C("their-card",n)}function R(e){var t=e.pid1==pid?e.p1:e.p2,n=e.pid1==pid?e.p2:e.p1;C("my-card",t),C("their-card",n);var o=e.results,s=o["p1-result"],i=o["p2-result"];""!=i&&($("p2-turn-results").innerHTML="Player 2 played "+o["p2-move"]+" and "+i+"!"),""!=s&&($("p1-turn-results").innerHTML="Player 1 played "+o["p1-move"]+" and "+s+"!"),hide($("loading")),show([$("p1-turn-results"),$("p2-turn-results")])}function C(e,t){if(!t.error){var n=$(e);n.querySelector(".hp").innerText=t["current-hp"]+"HP",n.querySelector(".buffs").innerHTML="",M($$("#"+e+" .buffs"),t.buffs,t.debuffs);var o=1*t["current-hp"]/t.hp;if(n.querySelector(".health-bar").style.width=100*o+"%","my-card"==e)0==o?B(!1):.2>=o&&n.querySelector(".health-bar").classList.add("low-health");else if("their-card"==e)if(0==o){if(B(!0),"medskm"==pid||"-bot-"!=J){A(t.name);var s=(t.images.photo,t.name),i=$("my-pokemon").querySelector(".sprite[pokemon="+s+"]");i.classList.contains("unfound")&&A(s)}}else.2>=o&&n.querySelector(".health-bar").classList.add("low-health")}hide($("loading"))}function A(e){var t=new FormData;if(t.append("name",e),confirm("Do you want to give "+e+" a nickname?")){var n=prompt("Nickname: ");t.append("nickname",n)}postRequest(STUDENT_PHP+"insert.php",t,function(){console.log("Success!"),r(pid,"pokedex-view"),r(pid,"my-pokemon")})}function M(e,t,n){for(var o=0;o<t.length+n.length;o++){var s=o<t.length?t[o]:n[o],i=document.createElement("div");i.className=o<t.length?"buff":"debuff",i.classList.add(s),e.appendChild(i)}return e}function B(e){for(var t=$("my-card").querySelectorAll(".moves button"),n=0;n<t.length;n++)t[n].disabled=!0;$("title").innerHTML="You "+(e?"won!":"lost!"),show([$("results-container"),$("endgame")])}function D(){for(var e=$$(".opponent-btn"),t=0;t<e.length;t++)e[t].classList.remove("chosen-btn"),e[t].classList.remove("hidden");e=$$(".menu-btn");for(var t=0;t<e.length;t++)e[t].classList.remove("chosen-btn")}function W(){for(var e=document.querySelectorAll(".sub-menu"),t=0;t<e.length;t++)hide(e[t])}function O(e,t){if($(e).classList.contains("chosen-btn"))$(e).classList.remove("chosen-btn"),W();else{for(var n=document.querySelectorAll(".sub-menu"),o=document.querySelectorAll(".chosen-btn"),s=0;s<o.length;s++)o[s]!=e&&o[s].classList.remove("chosen-btn");if($(e).classList.add("chosen-btn"),$(t).classList.contains("hidden"))for(var s=0;s<n.length;s++)n[s]!=$(t)?hide(n[s]):(show(n[s]),"trade-view"===t&&(hide($("new-proposal-view")),hide($("current-proposals-view"))))}}var G="",J="",I="";window.onload=function(){fetchPid(),k(),d(),t(),s(),o(),$("main-menu-btn").onclick=e,$("endgame").onclick=e,$("restart-btn").onclick=function(){confirm("Are you sure you want to remove all Pokemon from your Pokedex and start with three new random Pokemon?")&&getDex(pid,token,!0)}}}();